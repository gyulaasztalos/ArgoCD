---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: homepage-secret
  namespace: homepage
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: onepassword-connect           # your ClusterSecretStore name
    kind: ClusterSecretStore
  target:
    name: homepage-secret     # name of the Kubernetes Secret to be created
    creationPolicy: Owner
    template:
      engineVersion: v2
      type: Opaque
      data:
        services.yaml: |
          ---
          # For configuration options and examples, please see:
          # https://gethomepage.dev/en/configs/services

          - Line 0A:
              - Unifi:
                  icon: unifi
                  href: https://unifi.local.asztalos.net
                  widget:
                      type: unifi
                      url: https://unifi.local.asztalos.net
                      username: homepage
                      password: {{ .unifi_homepage_password }}

          - Line 0B:
              - UNVR-PRO:
                  icon: unifi
                  href: https://unvr-pro.local.asztalos.net
                  ping: https://unvr-pro.local.asztalos.net
              - Apprise:
                  icon: apprise
                  href: https://apprise.local.asztalos.net/cfg/apprise
                  ping: https://apprise.apprise.svc.cluster.local
                  app: apprise
                  namespace: apprise

          - Line 0C:
              - FlexGet:
                  icon: flexget
                  href: https://flexget.local.asztalos.net
                  ping: https://flexget.flexget.svc.cluster.local
                  app: flexget
                  namespace: flexget
              - ddns-updater:
                  icon: ddns-updater
                  href: https://ddns-updater.local.asztalos.net
                  ping: https://ddns-updater.ddns-updater.svc.cluster.local
                  app: ddns-updater
                  namespace: ddns-updater

          - Line 1:
              - Traefik:
                  icon: traefik
                  href: https://traefik.local.asztalos.net
                  ping: https://traefik.local.asztalos.net
                  app: traefik
                  namespace: traefik
                  widget:
                      type: traefik
                      url: http://traefik.traefik.svc.cluster.local
                      username: red # optional
                      password: {{ .traefik_dashboard_auth }}

          - Line 2:
              - Homebridge:
                  icon: homebridge
                  href: https://homebridge.local.asztalos.net
                  ping: https://homebridge.local.asztalos.net
                  app: homebridge
                  namespace: homebridge
                  widget:
                      type: homebridge
                      url: https://homebridge.homebridge.svc.cluster.local:8581
                      username: homepage
                      password: {{ .homebridge_homepage_password }}

              - Pi-Hole Raspberry Pi:
                  icon: pi-hole
                  href: https://pihole-rpi.local.asztalos.net/admin/
                  ping: https://pihole-rpi.local.asztalos.net/admin/
                  widget:
                      type: pihole
                      version: 6
                      url: https://pihole-rpi.local.asztalos.net
                      key: {{ .pihole_rpi_password }}

              - Pi-Hole Cluster:
                  icon: pi-hole
                  href: https://pihole.local.asztalos.net/admin/
                  ping: https://pihole.local.asztalos.net/admin/
                  app: pihole
                  namespace: pihole
                  widget:
                      type: pihole
                      version: 6
                      url: http://pihole-web.pihole.svc.cluster.local
                      key: {{ .pihole_cluster_password }}

              - Transmission:
          #        description: Torrent client
                  icon: transmission
                  href: http://transmission.local.asztalos.net:9091/transmission/web/
                  ping: http://transmission.local.asztalos.net:9091/transmission/web/
                  app: transmission
                  namespace: transmission
                  widget:
                      type: transmission
                      url: http://transmission-peer-tcp.transmission.svc.cluster.local:9091
                      username: {{ .transmission_username}}
                      password: {{ .transmission_password}}
                      rpcUrl: /transmission/ # Optional. Matches the value of "rpc-url" in your Transmission's settings.json file

          - Line 4:
              - Prometheus:
          #        description: Metrics scraper
                  icon: prometheus
                  href: https://prometheus.local.asztalos.net
                  ping: https://prometheus.local.asztalos.net
                  app: prometheus
                  namespace: monitoring
                  widget:
                      type: prometheus
                      url: http://monitoring-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090

              - Grafana:
                  icon: grafana
                  href: https://grafana.local.asztalos.net
                  ping: https://grafana.local.asztalos.net
                  app: grafana
                  namespace: monitoring
                  widget:
                    type: grafana
                    url: http://monitoring-grafana.monitoring.svc.cluster.local
                    username: {{ .grafana_username }}
                    password: {{ .grafana_password }}

              - Paperless-ngx:
                  icon: paperless-ngx
                  href: https://paperless.local.asztalos.net
                  ping: https://paperless.local.asztalos.net
                  app: paperless-ngx
                  namespace: paperless-ngx
                  widget:
                      type: paperlessngx
                      url: http://paperless-ngx.paperless-ngx.svc.cluster.local:8000
                      username: homepage
                      password: {{ .paperless_ngx_homepage_password }}

  data:
    - secretKey: traefik_dashboard_auth            # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: traefik-dashboard-auth
        property: users  # 1Password item name
    - secretKey: homebridge_homepage_password            # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: homepage
        property: homebridge  # 1Password item name
    - secretKey: pihole_rpi_password            # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: homepage
        property: pihole-rpi  # 1Password item name
    - secretKey: pihole_cluster_password            # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: pihole-secret
        property: webpassword
    - secretKey: transmission_username            # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: transmission
        property: username
    - secretKey: transmission_password            # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: transmission
        property: password
    - secretKey: grafana_username           # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: grafana-secrets
        property: admin-user
    - secretKey: grafana_password           # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: grafana-secrets
        property: admin-password
    - secretKey: paperless_ngx_homepage_password            # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None

        key: homepage
        property: paperless-ngx  # 1Password item name
    - secretKey: unifi_homepage_password            # key in the Kubernetes Secret
      remoteRef:
        conversionStrategy: Default
        decodingStrategy: None
        metadataPolicy: None
        key: homepage
        property: unifi  # 1Password item name
