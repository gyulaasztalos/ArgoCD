---
apiVersion: external-secrets.io/v1
kind: ExternalSecret
metadata:
  name: homepage-secret
  namespace: homepage
spec:
  refreshInterval: 1h
  secretStoreRef:
    name: onepassword-connect           # your ClusterSecretStore name
    kind: ClusterSecretStore
  target:
    name: homepage-secret     # name of the Kubernetes Secret to be created
    creationPolicy: Owner
    template:
      engineVersion: v2
      type: Opaque
      data:
        services.yaml: |
          ---
          # For configuration options and examples, please see:
          # https://gethomepage.dev/en/configs/services

          - Line 0A:
              - Unifi:
                  icon: unifi
                  href: https://unifi.local.asztalos.net
                  widget:
                      type: unifi
                      url: https://unifi.local.asztalos.net
                      username: homepage
                      password: {{ .unifi-homepage-password }}

          - Line 0B:
              - UNVR-PRO:
                  icon: unifi
                  href: https://unvr-pro.local.asztalos.net
                  ping: https://unvr-pro.local.asztalos.net
              - Apprise:
                  icon: apprise
                  href: https://apprise.local.asztalos.net/cfg/apprise
                  ping: https://apprise.local.asztalos.net/cfg/apprise
                  app: apprise
                  namespace: apprise

          - Line 0C:
              - FlexGet:
                  icon: flexget
                  href: https://flexget.local.asztalos.net
                  ping: https://flexget.local.asztalos.net
                  app: flexget
                  namespace: flexget
              - ddns-updater:
                  icon: ddns-updater
                  href: https://ddns-updater.local.asztalos.net
                  ping: https://ddns-updater.local.asztalos.net
                  app: ddns-updater
                  namespace: ddns-updater

          - Line 1:
              - Traefik:
                  icon: traefik
                  href: https://traefik.local.asztalos.net
                  ping: https://traefik.local.asztalos.net
                  app: traefik
                  namespace: traefik
                  widget:
                      type: traefik
                      url: http://traefik.traefik.svc.cluster.local:8080
                      username: red # optional
                      password: {{ .traefik-dashboard-auth  }}

          - Line 2:
              - Homebridge:
                  icon: homebridge
                  href: https://homebridge.local.asztalos.net
                  ping: https://homebridge.local.asztalos.net
                  app: homebridge
                  namespace: homebridge
                  widget:
                      type: homebridge
                      url: https://homebridge.local.asztalos.net
                      username: homepage
                      password: {{ .homebridge-homepage-password }}

              - Pi-Hole Raspberry Pi:
                  icon: pi-hole
                  href: https://pihole-rpi.local.asztalos.net/admin/
                  ping: https://pihole-rpi.local.asztalos.net/admin/
                  widget:
                      type: pihole
                      version: 6
                      url: https://pihole-rpi.local.asztalos.net
                      key: {{ .pihole-rpi-password }}

              - Pi-Hole Cluster:
                  icon: pi-hole
                  href: https://pihole.local.asztalos.net/admin/
                  ping: https://pihole.local.asztalos.net/admin/
                  app: pihole
                  namespace: pihole
                  widget:
                      type: pihole
                      version: 6
                      url: http://pihole.pihole.svc.cluster.local
                      key: {{ .pihole-cluster-password }}

              - Transmission:
          #        description: Torrent client
                  icon: transmission
                  href: http://transmission.local.asztalos.net:9091/transmission/web/
                  ping: http://transmission.local.asztalos.net:9091/transmission/web/
                  app: transmission
                  namespace: transmission
                  widget:
                      type: transmission
                      url: http://transmission.transmission.svc.cluster.local:9091
                      username: {{ .transmission-username}}
                      password: {{ .transmission-password}}
                      rpcUrl: /transmission/ # Optional. Matches the value of "rpc-url" in your Transmission's settings.json file

          - Line 4:
              - Prometheus:
          #        description: Metrics scraper
                  icon: prometheus
                  href: https://prometheus.local.asztalos.net
                  ping: https://prometheus.local.asztalos.net
                  app: prometheus
                  namespace: monitoring
                  widget:
                      type: prometheus
                      url: http://monitoring-kube-prometheus-prometheus.monitoring.svc.cluster.local:9090

              - Grafana:
                  icon: grafana
                  href: https://grafana.local.asztalos.net
                  ping: https://grafana.local.asztalos.net
                  app: grafana
                  namespace: monitoring
                  widget:
                    type: grafana
                    url: http://monitoring-grafana.monitoring.svc.cluster.local
                    username: {{ .grafana-username }}
                    password: {{ .grafana-password }}

              - Paperless-ngx:
                  icon: paperless-ngx
                  href: https://paperless.local.asztalos.net
                  ping: https://paperless.local.asztalos.net
                  app: paperless-ngx
                  namespace: paperless-ngx
                  widget:
                      type: paperlessngx
                      url: http://paperless-ngx.paperless-ngx.svc.cluster.local:8000
                      username: homepage
                      password: {{ .paperless-ngx-homepage-password }}

  data:
    - secretKey: traefik-dashboard-auth            # key in the Kubernetes Secret
      remoteRef:
        key: traefik-dashboard-auth
        property: users  # 1Password item name
    - secretKey: homebridge-homepage-password            # key in the Kubernetes Secret
      remoteRef:
        key: homepage
        property: homebridge  # 1Password item name
    - secretKey: pihole-rpi-password            # key in the Kubernetes Secret
      remoteRef:
        key: homepage
        property: pihole-rpi  # 1Password item name
    - secretKey: pihole-cluster-password            # key in the Kubernetes Secret
      remoteRef:
        key: pihole-secret
        property: webpassword
    - secretKey: transmission-username            # key in the Kubernetes Secret
      remoteRef:
        key: transmission
        property: username
    - secretKey: transmission-password            # key in the Kubernetes Secret
      remoteRef:
        key: transmission
        property: password
    - secretKey: grafana-username           # key in the Kubernetes Secret
      remoteRef:
        key: grafana-secret
        property: admin-user
    - secretKey: grafana-password           # key in the Kubernetes Secret
      remoteRef:
        key: grafana-secret
        property: admin-password
    - secretKey: paperless-ngx-homepage-password            # key in the Kubernetes Secret
      remoteRef:
        key: homepage
        property: paperless-ngx  # 1Password item name
    - secretKey: unifi-homepage-password            # key in the Kubernetes Secret
      remoteRef:
        key: homepage
        property: unifi  # 1Password item name
